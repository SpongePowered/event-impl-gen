plugins {
    id "org.spongepowered.gradle.sponge.dev" version "1.0.2"
    id "net.kyori.indra.publishing.gradle-plugin" version "1.3.1"
    id "java-gradle-plugin"
    id 'com.gradle.plugin-publish' version '0.13.0'
}

// Default tasks
defaultTasks 'licenseFormat', 'build'

// Basic project information
group = "org.spongepowered"

spongeConvention {
    repository("event-impl-gen") {
        ci = true
        publishing = true
    }
    mitLicense()

    licenseParameters {
        name = rootProject.projectName
        organization = rootProject.organization
        url = rootProject.url
    }

    sharedManifest {
        attributes(
                'Git-Commit': grgit?.head()?.id,
                "Git-Branch": grgit?.branch?.current()?.name,

                "Implementation-Title": project.name,
                "Implementation-Version": project.version,
                "Implementation-Vendor": project.url
        )
    }
}

// Project repositories and dependencies
repositories {
    maven {
        url = "https://repo.spongepowered.org/repository/maven-public/"
        name = "sponge"
    }
}

dependencies {
    implementation "fr.inria.gforge.spoon:spoon-core:8.3.0"
    implementation "org.ow2.asm:asm:9.0"
    compileOnlyApi "org.checkerframework:checker-qual:3.11.0"
    compileOnlyApi "com.google.errorprone:error_prone_annotations:2.5.1"

    testImplementation("org.junit.jupiter:junit-jupiter-api:5.7.1")
    testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.7.1")

    /* TODO: Re-enable when test is fixed
    testCompile 'junit:junit:4.12'
    testCompile 'org.hamcrest:hamcrest-library:1.3'

    testCompile 'org.mockito:mockito-core:1.10.19'
    testCompile 'org.powermock:powermock-module-junit4:1.6.6'
    testCompile 'org.powermock:powermock-api-mockito:1.6.6'
    */
}

indraPluginPublishing {
    plugin(
            "event-impl-gen",
            "org.spongepowered.eventimplgen.EventImplGenPlugin",
            "Sponge Event Implementation Generator",
            project.description,
            ["minecraft", "sponge"]
    )
}

pluginBundle {
    website = "https://github.com/$project.organization/$project.name"
    vcsUrl = website
    description = project.description
    tags = ['minecraft', 'sponge']
}